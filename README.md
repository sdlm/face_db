# face_db
DB for store face features

# общий план
1. загружаем фотку, выдернуть из неё лица людей
2. по выдернутым лицам найти их отображение в вектора
3. провести поиск векторов по базе профилей
4. выдать список профилей (тех людей что были на фото)

# разбиваем на сервисы

## данные
1. исходные фотки
2. фичи
3. профили (+фото)

## сервисы
1. Обход базы фоток, наполнение базы фич
2. Поиск исходных фоток содержащих фичи такие же как и на переданном фото

# сервисы подробнее

## Сервис 1. Обход базы фоток, наполнение базы фич.
1. планировщик: запросить все необработанные фотки, создать на них задачи
2. задачи имеют вид:
    1. выделить лица на фото
    2. выделить фичи
    3. записать фичи в базу

## Сервис 2. Поиск фоток по фото с лицом
1. на вход подается фото
2. выдираем первое лицо с фото
3. выдираем фичи
4. ищем фичи по базе профилей
    - если есть, то отдаем исходные фото связанные с этим профилем
    - если нет, то проводим поиск по базе фич, создаем профиль

# базы подробнее
1. фото
    - фото (действительно надо ?)
    - гео данные
    - ссылка
    - доп. поля
2. фичи
    - фичи
    - fk на фото
    - fk на профиль
3. профили
    - UUID
    - усредненные фичи
    - m2m на фото

## Заметки
- при поступлении запроса поиска по фото:
    1. выдираем первое лицо с фото
    2. выдираем фичи
    3. ищем фичи по базе профилей
        - если есть, то отдаем профиль
        - если нет, то проводим поиск по базе фич
- "индексация", берем пачку фич, проводим поиск похожих, если есть похожие то создаем по ним профиль
    - поиск похожих среди [1..N]:
        1. взять очередную фичу K
        2. сравнить её со всеми [K..N]
        3. если нашлись похожие, то выставить им fk на фичу K, и исключить из дальнейших сравнений
- в сервисе по наполнению базы фич выделить два доп сервиса
    - выделить лица на фото
    - выделить фичи